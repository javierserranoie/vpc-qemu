---
- name: Ensure systemd network directory exists
  file:
    path: /etc/systemd/network
    state: directory
    mode: '0755'

- name: Deploy systemd network configuration
  template:
    src: 10-br-k8s.network.j2
    dest: /etc/systemd/network/10-br-k8s.network
    mode: '0644'
  notify: restart systemd-networkd

- name: Ensure scripts directory exists
  file:
    path: /tmp
    state: directory
    mode: '0755'

- name: Copy base network config script
  copy:
    src: network.config
    dest: /tmp/network.config
    mode: '0755'

- name: Apply base network iptables configuration
  command: /tmp/network.config
  register: network_config_result
  changed_when: true

- name: Display network config output
  debug:
    var: network_config_result.stdout_lines
  when: network_config_result.stdout_lines is defined

